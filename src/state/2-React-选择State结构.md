# ğŸ—ï¸ Reactï¼šé€‰æ‹©Stateç»“æ„

## ğŸŒŸ æ„å»ºStateçš„åŸåˆ™

### ğŸ§  å¥½çš„Stateç»“æ„çš„é‡è¦æ€§
- ğŸ¯ **æ ¸å¿ƒç›®æ ‡**ï¼šä½¿çŠ¶æ€æ˜“äºæ›´æ–°è€Œä¸å¼•å…¥é”™è¯¯
- ğŸ§© **è®¾è®¡æ€è·¯**ï¼šå°½å¯èƒ½ç®€å•ï¼Œä½†ä¸è¦è¿‡äºç®€å•
- ğŸ› ï¸ **å½±å“èŒƒå›´**ï¼šçŠ¶æ€ç»“æ„ä¼šå½±å“ç»„ä»¶çš„å¯ç»´æŠ¤æ€§å’Œè°ƒè¯•éš¾åº¦

## ğŸ” äº”å¤§åŸåˆ™æŒ‡å—

### 1ï¸âƒ£ åˆå¹¶å…³è”çš„çŠ¶æ€
- ğŸ”„ **è¯†åˆ«æ ‡å¿—**ï¼šä¸¤ä¸ªçŠ¶æ€å˜é‡æ€»æ˜¯ä¸€èµ·æ›´æ–°
- ğŸ§© **è§£å†³æ–¹æ¡ˆ**ï¼šå°†å¤šä¸ªç›¸å…³çŠ¶æ€åˆå¹¶ä¸ºä¸€ä¸ªå¯¹è±¡æˆ–æ•°ç»„
- ğŸŒŸ **é€‚ç”¨åœºæ™¯**ï¼šåæ ‡ä½ç½®(x,y)ã€è¡¨å•çš„å¤šä¸ªå­—æ®µ

```jsx
// âŒ åˆ†ç¦»çš„å…³è”çŠ¶æ€
const [x, setX] = useState(0);
const [y, setY] = useState(0);

// âœ… åˆå¹¶ä¸ºä¸€ä¸ªçŠ¶æ€å¯¹è±¡
const [position, setPosition] = useState({ x: 0, y: 0 });

// æ›´æ–°åˆå¹¶çŠ¶æ€
setPosition({ x: 100, y: 100 });
// éƒ¨åˆ†æ›´æ–°ï¼Œè®°å¾—ä½¿ç”¨å±•å¼€è¯­æ³•
setPosition({ ...position, x: 100 });
```

### 2ï¸âƒ£ é¿å…çŠ¶æ€çŸ›ç›¾
- âš ï¸ **æ½œåœ¨é—®é¢˜**ï¼šå¤šä¸ªçŠ¶æ€å˜é‡å¯èƒ½äº§ç”Ÿäº’ç›¸çŸ›ç›¾çš„å€¼
- ğŸ§  **è§£å†³æ–¹æ¡ˆ**ï¼šä½¿ç”¨ä¸€ä¸ªçŠ¶æ€å˜é‡è¡¨ç¤ºæ‰€æœ‰å¯èƒ½çš„æƒ…å†µ
- ğŸ­ **å…¸å‹ä¾‹å­**ï¼šä½¿ç”¨ä¸€ä¸ªstatuså­—æ®µä»£æ›¿å¤šä¸ªå¸ƒå°”å€¼

```jsx
// âŒ å¯èƒ½äº§ç”ŸçŸ›ç›¾çš„çŠ¶æ€
const [isSending, setIsSending] = useState(false);
const [isSent, setIsSent] = useState(false);

// âœ… ä½¿ç”¨ä¸€ä¸ªstatusçŠ¶æ€é¿å…çŸ›ç›¾
const [status, setStatus] = useState('typing'); // 'typing', 'sending', 'sent'
```

### 3ï¸âƒ£ é¿å…å†—ä½™çŠ¶æ€
- ğŸ” **å…³é”®é—®é¢˜**ï¼šæ˜¯å¦å¯ä»¥ä»ç°æœ‰propsæˆ–stateè®¡ç®—å‡ºæ¥ï¼Ÿ
- ğŸ§® **è§£å†³æ–¹æ¡ˆ**ï¼šåœ¨æ¸²æŸ“æœŸé—´è®¡ç®—æ´¾ç”Ÿå€¼ï¼Œè€Œä¸æ˜¯å­˜å‚¨
- ğŸš« **é¿å…å­˜å‚¨**ï¼šä»propsæ´¾ç”Ÿçš„çŠ¶æ€ã€å¯è®¡ç®—çš„åˆ—è¡¨å±æ€§ç­‰

```jsx
// âŒ å†—ä½™çŠ¶æ€
const [items, setItems] = useState(initialItems);
const [selectedItem, setSelectedItem] = useState(items[0]);

// âœ… é€šè¿‡IDå¼•ç”¨ä¿æŒåŒæ­¥
const [items, setItems] = useState(initialItems);
const [selectedId, setSelectedId] = useState(items[0].id);

// åœ¨æ¸²æŸ“æ—¶è®¡ç®—æ´¾ç”Ÿå€¼
const selectedItem = items.find(item => item.id === selectedId);
```

### 4ï¸âƒ£ é¿å…çŠ¶æ€é‡å¤
- ğŸ”„ **é‡å¤é—®é¢˜**ï¼šåŒä¸€æ•°æ®åœ¨å¤šä¸ªçŠ¶æ€å˜é‡æˆ–åµŒå¥—å¯¹è±¡ä¸­å‡ºç°
- ğŸ§  **è§£å†³æ–¹æ¡ˆ**ï¼šé€‰æ‹©ä¸€ä¸ªæ•°æ®æºä½œä¸º"å¯ä¿¡æ¥æº"
- ğŸŒŸ **æœ€ä½³å®è·µ**ï¼šæŒ‰IDå¼•ç”¨å¯¹è±¡ï¼Œè€Œéå­˜å‚¨å®Œæ•´å¯¹è±¡å‰¯æœ¬

```jsx
// âŒ å­˜å‚¨å®Œæ•´å¯¹è±¡ï¼Œå¯¼è‡´é‡å¤
const [users, setUsers] = useState([]);
const [selectedUser, setSelectedUser] = useState(null);

// âœ… åªå­˜å‚¨IDï¼Œé¿å…é‡å¤
const [users, setUsers] = useState([]);
const [selectedUserId, setSelectedUserId] = useState(null);

// åœ¨éœ€è¦æ—¶é€šè¿‡IDæŸ¥æ‰¾å®Œæ•´å¯¹è±¡
const selectedUser = users.find(user => user.id === selectedUserId);
```

### 5ï¸âƒ£ é¿å…æ·±åº¦åµŒå¥—çŠ¶æ€
- ğŸª† **åµŒå¥—é—®é¢˜**ï¼šå¤šå±‚åµŒå¥—çš„çŠ¶æ€éš¾ä»¥æ›´æ–°å’Œç»´æŠ¤
- ğŸ“Š **è§£å†³æ–¹æ¡ˆ**ï¼šå°†çŠ¶æ€å±•å¹³ï¼ˆæ‰å¹³åŒ–/è§„èŒƒåŒ–ï¼‰
- ğŸ—‚ï¸ **æ¨èç»“æ„**ï¼šä½¿ç”¨IDä½œä¸ºé”®çš„å¯¹è±¡æ˜ å°„è¡¨

```jsx
// âŒ æ·±åº¦åµŒå¥—çš„çŠ¶æ€
const [nestedData, setNestedData] = useState({
  regions: {
    china: {
      cities: {
        beijing: { population: 21540000 },
        shanghai: { population: 24870000 }
      }
    }
  }
});

// âœ… æ‰å¹³åŒ–/è§„èŒƒåŒ–çš„çŠ¶æ€
const [data, setData] = useState({
  regions: { 1: { name: 'china', cityIds: [101, 102] }},
  cities: {
    101: { id: 101, name: 'beijing', population: 21540000 },
    102: { id: 102, name: 'shanghai', population: 24870000 }
  }
});
```

## ğŸš€ å®é™…æ¡ˆä¾‹åˆ†æ

### ğŸ§© æ‰å¹³åŒ–å¤æ‚åµŒå¥—ç»“æ„
- ğŸ“Š **åœºæ™¯**ï¼šå…·æœ‰å¤šå±‚çº§çš„åœ°ç‚¹æ ‘å½¢ç»“æ„
- ğŸ› ï¸ **è§£å†³æ–¹æ¡ˆ**ï¼šä½¿ç”¨"è¡¨"å¯¹è±¡å­˜å‚¨æ‰€æœ‰é¡¹ï¼Œç”¨IDç›¸äº’å¼•ç”¨
- ğŸ”‘ **ä¼˜åŠ¿**ï¼šæ›´æ–°æ“ä½œæ›´ç®€å•ï¼Œä¸éœ€è¦æ·±å±‚å¤åˆ¶

```jsx
// æ‰å¹³åŒ–çš„æ•°æ®ç»“æ„ç¤ºä¾‹
const placesById = {
  0: { id: 0, title: 'åœ°çƒ', childIds: [1, 2, 3] },
  1: { id: 1, title: 'äºšæ´²', childIds: [4, 5] },
  4: { id: 4, title: 'ä¸­å›½', childIds: [] },
  5: { id: 5, title: 'æ—¥æœ¬', childIds: [] },
  // ...æ›´å¤šåœ°ç‚¹
};

// æ›´æ–°åµŒå¥—é¡¹å˜å¾—ç®€å•
function handleComplete(parentId, childId) {
  // åˆ›å»ºçˆ¶é¡¹çš„æ–°ç‰ˆæœ¬ï¼Œè¿‡æ»¤æ‰è¦åˆ é™¤çš„å­é¡¹ID
  const nextParent = {
    ...placesById[parentId],
    childIds: placesById[parentId].childIds.filter(id => id !== childId)
  };
  
  // æ›´æ–°æ ¹çŠ¶æ€
  setPlacesById({
    ...placesById,
    [parentId]: nextParent
  });
}
```

## ğŸŒŸ é…åˆImmerç®€åŒ–æ›´æ–°

### ğŸ› ï¸ ä½¿ç”¨Immerå¤„ç†å¤æ‚çŠ¶æ€
- ğŸ” **é—®é¢˜**ï¼šå³ä½¿ä½¿ç”¨æ‰å¹³åŒ–çŠ¶æ€ï¼Œæ›´æ–°é€»è¾‘ä»å¯èƒ½å¤æ‚
- ğŸ§° **å·¥å…·**ï¼šImmeråº“å¯ä»¥è®©ä½ ä½¿ç”¨ç®€æ´çš„å¯å˜è¯­æ³•ç¼–å†™ä¸å¯å˜æ›´æ–°
- ğŸš€ **ä¼˜åŠ¿**ï¼šä»£ç æ›´ç®€æ´ï¼Œæ›´æ˜“äºç†è§£

```jsx
// ä½¿ç”¨Immerç®€åŒ–æ›´æ–°
import { useImmer } from 'use-immer';

// æ›¿ä»£useState
const [places, updatePlaces] = useImmer(initialPlaces);

// æ›´ç®€æ´çš„æ›´æ–°é€»è¾‘
function handleComplete(parentId, childId) {
  updatePlaces(draft => {
    // å¯ä»¥ç›´æ¥"ä¿®æ”¹" draft
    const parent = draft[parentId];
    parent.childIds = parent.childIds.filter(id => id !== childId);
  });
}
```

## ğŸ“ æ€»ç»“

- ğŸ§© **åˆå¹¶å…³è”çŠ¶æ€**ï¼šç›¸å…³çš„çŠ¶æ€å˜é‡åº”åˆå¹¶ä¸ºä¸€ä¸ªå¯¹è±¡æˆ–æ•°ç»„
- âš–ï¸ **é¿å…çŸ›ç›¾çŠ¶æ€**ï¼šç”¨å•ä¸€çŠ¶æ€å˜é‡è¡¨ç¤ºäº’æ–¥çš„UIçŠ¶æ€
- ğŸ§® **é¿å…å†—ä½™çŠ¶æ€**ï¼šèƒ½ä»propsæˆ–stateè®¡ç®—å‡ºçš„å€¼ä¸è¦å­˜å…¥state
- ğŸ”„ **é¿å…é‡å¤çŠ¶æ€**ï¼šåŒä¸€æ•°æ®ä¸åº”åœ¨å¤šå¤„å­˜å‚¨ï¼Œåº”æœ‰å”¯ä¸€æ•°æ®æº
- ğŸ“Š **é¿å…æ·±åº¦åµŒå¥—**ï¼šå°†å¤æ‚çŠ¶æ€æ‰å¹³åŒ–ï¼Œä½¿ç”¨IDç›¸äº’å¼•ç”¨
- ğŸ› ï¸ **ä½¿ç”¨è¾…åŠ©å·¥å…·**ï¼šè€ƒè™‘ä½¿ç”¨Immerç­‰åº“ç®€åŒ–å¤æ‚çŠ¶æ€çš„æ›´æ–°é€»è¾‘

> å‚è€ƒï¼š[Reactå®˜æ–¹æ–‡æ¡£-é€‰æ‹©Stateç»“æ„](https://zh-hans.react.dev/learn/choosing-the-state-structure) 