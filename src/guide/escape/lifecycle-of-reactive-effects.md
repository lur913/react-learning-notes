# å“åº”å¼Effectçš„ç”Ÿå‘½å‘¨æœŸ

## ğŸŒŸ æ ¸å¿ƒæ¦‚å¿µ

### ğŸ’¡ ç»„ä»¶ä¸Effectç”Ÿå‘½å‘¨æœŸçš„åŒºåˆ«
- ğŸ—ï¸ **ç»„ä»¶ç”Ÿå‘½å‘¨æœŸ**ï¼šæŒ‚è½½ â†’ æ›´æ–° â†’ å¸è½½
- ğŸ”„ **Effectç”Ÿå‘½å‘¨æœŸ**ï¼šå¼€å§‹åŒæ­¥ â†’ åœæ­¢åŒæ­¥ â†’ (å¯èƒ½é‡å¤å¤šæ¬¡)

### ğŸ¯ Effectçš„æœ¬è´¨
- ğŸ“Š **Effectæ˜¯åŒæ­¥çš„è¿‡ç¨‹**ï¼šå°†ç»„ä»¶ä¸å¤–éƒ¨ç³»ç»ŸåŒæ­¥
- ğŸ” **ç‹¬ç«‹äºç»„ä»¶ç”Ÿå‘½å‘¨æœŸ**ï¼šåŒæ­¥å¯èƒ½åœ¨ç»„ä»¶æ›´æ–°æ—¶å‘ç”Ÿå¤šæ¬¡
- ğŸ§© **æè¿°äº†ä¸€ä¸ªå®Œæ•´è¿‡ç¨‹**ï¼šä»å¼€å§‹åˆ°ç»“æŸçš„å®Œæ•´åŒæ­¥æµç¨‹

```jsx
function ChatRoom({ roomId }) {
  useEffect(() => {
    // å¼€å§‹åŒæ­¥ - è¿æ¥åˆ°èŠå¤©å®¤
    const connection = createConnection(serverUrl, roomId);
    connection.connect();
    
    // åœæ­¢åŒæ­¥ - æ–­å¼€è¿æ¥
    return () => {
      connection.disconnect();
    };
  }, [roomId]);
}
```

## ğŸ“š Effecté‡æ–°åŒæ­¥çš„è¿‡ç¨‹

### ğŸ”„ é‡æ–°åŒæ­¥çš„æ—¶æœº
1. ğŸ—ï¸ **é¦–æ¬¡æ¸²æŸ“å**ï¼šç»„ä»¶æŒ‚è½½æ—¶å¼€å§‹åˆå§‹åŒæ­¥
2. ğŸ”„ **ä¾èµ–é¡¹å˜åŒ–å**ï¼šåœæ­¢æ—§åŒæ­¥ â†’ å¼€å§‹æ–°åŒæ­¥
3. ğŸ—‘ï¸ **ç»„ä»¶å¸è½½æ—¶**ï¼šåœæ­¢åŒæ­¥

### ğŸ” é‡æ–°åŒæ­¥çš„ä¾‹å­

```jsx
// roomIdä¸º"general"æ—¶çš„åˆå§‹åŒæ­¥
// 1. è¿æ¥åˆ°"general"èŠå¤©å®¤

// ç”¨æˆ·å°†roomIdåˆ‡æ¢ä¸º"travel"
// 1. æ–­å¼€ä¸"general"èŠå¤©å®¤çš„è¿æ¥
// 2. è¿æ¥åˆ°"travel"èŠå¤©å®¤

// ç”¨æˆ·å¯¼èˆªç¦»å¼€é¡µé¢
// 1. æ–­å¼€ä¸"travel"èŠå¤©å®¤çš„è¿æ¥
```

## ğŸ§ ä»Effectè§’åº¦æ€è€ƒ

### ğŸ­ æ¯ä¸ªEffectæè¿°ç‹¬ç«‹çš„åŒæ­¥è¿‡ç¨‹
- ğŸ” **ä¸è¦ä»ç»„ä»¶è§’åº¦æ€è€ƒ**ï¼šä¸æ˜¯"æŒ‚è½½æ—¶åšä»€ä¹ˆï¼Œæ›´æ–°æ—¶åšä»€ä¹ˆ"
- âœ… **åº”è¯¥ä»Effectè§’åº¦æ€è€ƒ**ï¼šè¿™ä¸ªEffectéœ€è¦å¦‚ä½•å¼€å§‹å’Œåœæ­¢åŒæ­¥ï¼Ÿ

### ğŸ“ æ­£ç¡®çš„æ€è€ƒæ–¹å¼
```jsx
function ChatRoom({ roomId }) {
  useEffect(() => {
    // Effectçš„æ€ç»´æ¨¡å¼: å®ç°å®Œæ•´çš„åŒæ­¥è¿‡ç¨‹
    const connection = createConnection(serverUrl, roomId);
    connection.connect();
    return () => connection.disconnect();
  }, [roomId]);
}
```

## ğŸ§ª å“åº”å¼å€¼ä¸ä¾èµ–

### ğŸ” ä»€ä¹ˆæ˜¯å“åº”å¼å€¼ï¼Ÿ
- âš›ï¸ **Props** - å¯èƒ½éšæ¸²æŸ“å˜åŒ–çš„å€¼
- ğŸ’¾ **State** - ç»„ä»¶å†…éƒ¨çŠ¶æ€
- ğŸ§® **æ´¾ç”Ÿå€¼** - åœ¨ç»„ä»¶ä½“å†…åŸºäºpropsæˆ–stateè®¡ç®—çš„å˜é‡

```jsx
function ChatRoom({ roomId }) { // roomIdæ˜¯å“åº”å¼çš„(props)
  const [message, setMessage] = useState(''); // messageæ˜¯å“åº”å¼çš„(state)
  const connectionURL = serverUrl + '/' + roomId; // connectionURLæ˜¯å“åº”å¼çš„(æ´¾ç”Ÿå€¼)
  
  useEffect(() => {
    const connection = createConnection(connectionURL);
    connection.connect();
    return () => connection.disconnect();
  }, [connectionURL]); // å¿…é¡»å£°æ˜ä¾èµ–
}
```

### ğŸ“‹ ä¾èµ–é¡¹æ£€æŸ¥è§„åˆ™

- ğŸ” **Reactä¼šéªŒè¯ä¾èµ–é¡¹**ï¼šæ‰€æœ‰å“åº”å¼å€¼å¿…é¡»åœ¨ä¾èµ–æ•°ç»„ä¸­å£°æ˜
- ğŸš¨ **ä¸èƒ½"é€‰æ‹©"ä¾èµ–é¡¹**ï¼šä¾èµ–é¡¹ç”±Effectå†…éƒ¨ä½¿ç”¨çš„å“åº”å¼å€¼å†³å®š
- ğŸ§¹ **ç©ºä¾èµ–æ•°ç»„ `[]`**ï¼šè¡¨ç¤ºEffectä¸ä¾èµ–ä»»ä½•å“åº”å¼å€¼ï¼Œä»…åœ¨æŒ‚è½½å’Œå¸è½½æ—¶è¿è¡Œ

```jsx
// âŒ é”™è¯¯ï¼šä¾èµ–é¡¹ç¼ºå¤±
useEffect(() => {
  const connection = createConnection(serverUrl, roomId);
  connection.connect();
  return () => connection.disconnect();
}, []); // ç¼ºå°‘roomIdä¾èµ–

// âœ… æ­£ç¡®ï¼šåŒ…å«æ‰€æœ‰ä¾èµ–
useEffect(() => {
  const connection = createConnection(serverUrl, roomId);
  connection.connect();
  return () => connection.disconnect();
}, [roomId]);
```

## ğŸ› ï¸ è§£å†³ä¾èµ–é¡¹é—®é¢˜çš„æ–¹æ³•

### ğŸ§© æ‹†åˆ†å¤šä¸ªEffect
- ğŸ“Š **æ¯ä¸ªEffectè¡¨ç¤ºä¸€ä¸ªç‹¬ç«‹çš„åŒæ­¥è¿‡ç¨‹**
- ğŸ”€ **ä¸åŒçš„å…³æ³¨ç‚¹æ”¾åœ¨ä¸åŒçš„Effectä¸­**

### ğŸ” æå–éå“åº”å¼é€»è¾‘
- ğŸ·ï¸ **ä½¿ç”¨Effect Event**ï¼šå¯ä»¥è®©éƒ¨åˆ†é€»è¾‘ä¸è§¦å‘é‡æ–°åŒæ­¥
- ğŸ“¡ **å°†äº‹ä»¶å¤„ç†ä»Effectä¸­åˆ†ç¦»**ï¼šåŒºåˆ†å“åº”å¼å’Œéå“åº”å¼ä»£ç 

### ğŸ›¡ï¸ é¿å…å¯¹è±¡å’Œå‡½æ•°ä¾èµ–
- ğŸ­ **å°†åˆ›å»ºç§»åˆ°Effectå†…éƒ¨**ï¼šé¿å…æ¯æ¬¡æ¸²æŸ“éƒ½åˆ›å»ºæ–°å¼•ç”¨
- ğŸ§® **ä½¿ç”¨åŸå§‹å€¼ä½œä¸ºä¾èµ–**ï¼šä½¿ç”¨å¯¹è±¡/å‡½æ•°çš„å„ä¸ªåŸå§‹å­—æ®µ

## âš ï¸ å¸¸è§é™·é˜±ä¸è§£å†³æ–¹æ¡ˆ

### ğŸš« ä¸è¦ç¦ç”¨ä¾èµ–æ£€æŸ¥å·¥å…·
```jsx
// ğŸ”´ é”™è¯¯åšæ³•
useEffect(() => {
  // ...
  // eslint-ignore-next-line react-hooks/exhaustive-deps
}, []);
```

### âœ… æ­£ç¡®è§£å†³æ–¹æ³•æ˜¯é‡æ„ä»£ç 
- ğŸ§© **æ‹†åˆ†Effect**
- ğŸ·ï¸ **ä½¿ç”¨useEffectEvent**
- ğŸ§ª **è°ƒæ•´å“åº”å¼è®¾è®¡**

## ğŸ“ æ€»ç»“

- ğŸ”„ Effectæœ‰ç‹¬ç«‹äºç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸï¼šå¼€å§‹åŒæ­¥å’Œåœæ­¢åŒæ­¥
- ğŸ§© æ¯ä¸ªEffectåº”æè¿°ä¸€ä¸ªç‹¬ç«‹çš„åŒæ­¥è¿‡ç¨‹
- ğŸ“Š å“åº”å¼å€¼ï¼ˆpropsã€stateåŠå…¶æ´¾ç”Ÿå€¼ï¼‰çš„å˜åŒ–ä¼šè§¦å‘Effecté‡æ–°åŒæ­¥
- ğŸ“‹ ä¾èµ–é¡¹å¿…é¡»åŒ…å«Effectä¸­ä½¿ç”¨çš„æ‰€æœ‰å“åº”å¼å€¼
- ğŸ§  Reactä¼šé€šè¿‡ä»£ç æ£€æŸ¥å·¥å…·éªŒè¯ä¾èµ–é¡¹çš„æ­£ç¡®æ€§
- ğŸ› ï¸ ä¿®å¤ä¾èµ–é—®é¢˜åº”è¯¥é€šè¿‡é‡æ„ä»£ç ï¼Œè€Œä¸æ˜¯å¿½ç•¥æ£€æŸ¥è§„åˆ™

> å‚è€ƒï¼š[Reactå®˜æ–¹æ–‡æ¡£-å“åº”å¼Effectçš„ç”Ÿå‘½å‘¨æœŸ](https://zh-hans.react.dev/learn/lifecycle-of-reactive-effects) 