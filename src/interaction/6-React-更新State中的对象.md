# ğŸ”„ React æ›´æ–° State ä¸­çš„å¯¹è±¡

## ğŸš« çŠ¶æ€ä¸å¯å˜åŸåˆ™

åœ¨Reactä¸­ï¼Œ**çŠ¶æ€(State)åº”è¢«è§†ä¸ºä¸å¯å˜çš„(immutable)**ï¼š
- ğŸ§Š å³ä½¿å¯¹è±¡åœ¨æŠ€æœ¯ä¸Šæ˜¯å¯å˜çš„ï¼Œä¹Ÿåº”å°†stateä¸­çš„å¯¹è±¡è§†ä¸ºåªè¯»
- âš ï¸ ç›´æ¥ä¿®æ”¹stateä¸­çš„å¯¹è±¡ä¸ä¼šè§¦å‘é‡æ–°æ¸²æŸ“
- ğŸ†• åº”åˆ›å»ºæ–°å¯¹è±¡æ›¿ä»£ä¿®æ”¹ç°æœ‰å¯¹è±¡

## âŒ é”™è¯¯çš„æ›´æ–°æ–¹å¼ï¼šç›´æ¥ä¿®æ”¹

```jsx
// âŒ é”™è¯¯æ–¹å¼ï¼šç›´æ¥ä¿®æ”¹stateå¯¹è±¡
function handleClick() {
  position.x = 100; // ç›´æ¥ä¿®æ”¹state
  position.y = 100; // Reactä¸ä¼šçŸ¥é“éœ€è¦é‡æ–°æ¸²æŸ“
}
```

ç›´æ¥ä¿®æ”¹é—®é¢˜ï¼š
- ğŸ”„ ä¸ä¼šè§¦å‘ç»„ä»¶é‡æ–°æ¸²æŸ“
- ğŸ§© ç ´åçŠ¶æ€å†å²è®°å½•ï¼ˆä¹‹å‰æ¸²æŸ“çš„"å¿«ç…§"ï¼‰
- ğŸ å¯¼è‡´éš¾ä»¥è°ƒè¯•çš„é—®é¢˜

## âœ… æ­£ç¡®çš„æ›´æ–°æ–¹å¼ï¼šæ›¿æ¢å¯¹è±¡

```jsx
// âœ… æ­£ç¡®æ–¹å¼ï¼šåˆ›å»ºæ–°å¯¹è±¡å¹¶ç”¨setStateæ›´æ–°
function handleClick() {
  setPosition({
    x: 100,
    y: 100
  }); // å®Œå…¨æ›¿æ¢å¯¹è±¡ï¼Œè§¦å‘é‡æ–°æ¸²æŸ“
}
```

## ğŸ“‹ ä½¿ç”¨å±•å¼€è¯­æ³•å¤åˆ¶å¯¹è±¡

å½“ä½ åªæƒ³æ›´æ–°å¯¹è±¡çš„éƒ¨åˆ†å±æ€§ï¼ŒåŒæ—¶ä¿ç•™å…¶ä»–å±æ€§ä¸å˜æ—¶ï¼Œå¯ä»¥ä½¿ç”¨**å±•å¼€è¯­æ³•**ï¼š

```jsx
// åªæ›´æ–°firstNameï¼Œä¿ç•™å…¶ä»–å±æ€§
setPerson({
  ...person, // å¤åˆ¶æ‰€æœ‰ç°æœ‰å±æ€§
  firstName: 'Jane' // è¦†ç›–ç‰¹å®šå±æ€§
});
```

## ğŸ§  è®°ä½ä½ çš„å±•å¼€è¯­æ³•

ä¸¤ç§å¸¸ç”¨å±•å¼€ä½ç½®ï¼š

```jsx
// åœ¨å¼€å¤´æ·»åŠ å±æ€§
setConfig({
  ...config,
  darkMode: true
});

// åœ¨æœ«å°¾æ·»åŠ å±æ€§
setConfig({
  darkMode: true,
  ...config
});
```

âš ï¸ å¦‚æœå¯¹è±¡ä¸­æœ‰åŒåå±æ€§ï¼Œ**åé¢çš„ä¼šè¦†ç›–å‰é¢çš„**ã€‚

## ğŸ”„ æ›´æ–°åµŒå¥—å¯¹è±¡

åµŒå¥—å¯¹è±¡éœ€è¦ç‰¹åˆ«å°å¿ƒå¤„ç†ï¼š

```jsx
const person = {
  name: 'Niki',
  artwork: {
    title: 'Blue Nana',
    city: 'Hamburg'
  }
};
```

è¦æ›´æ–°`city`å±æ€§ï¼Œéœ€è¦åˆ›å»ºä»ä¿®æ”¹ä½ç½®å¼€å§‹çš„æ‰€æœ‰å¯¹è±¡å‰¯æœ¬ï¼š

```jsx
setPerson({
  ...person, // å¤åˆ¶æœ€å¤–å±‚å¯¹è±¡
  artwork: {  // æ›¿æ¢artworkå¯¹è±¡
    ...person.artwork, // å¤åˆ¶ç°æœ‰artworkå±æ€§
    city: 'New Delhi' // ä»…è¦†ç›–city
  }
});
```

## ğŸŒ² åµŒå¥—æ›´æ·±çš„å¯¹è±¡

æ›´æ–°åµŒå¥—å¾ˆæ·±çš„å¯¹è±¡ä¼šå˜å¾—å†—é•¿ï¼š

```jsx
const nestedObj = {
  a: {
    b: {
      c: {
        d: {
          value: 5
        }
      }
    }
  }
};

// æ›´æ–°valueå±æ€§
setNestedObj({
  ...nestedObj,
  a: {
    ...nestedObj.a,
    b: {
      ...nestedObj.a.b,
      c: {
        ...nestedObj.a.b.c,
        d: {
          ...nestedObj.a.b.c.d,
          value: 10
        }
      }
    }
  }
});
```

## ğŸ§° ä½¿ç”¨Immerç®€åŒ–å¯¹è±¡æ›´æ–° 

**Immer**åº“å¯ä»¥å¤§å¹…ç®€åŒ–ä¸å¯å˜å¯¹è±¡æ›´æ–°é€»è¾‘ï¼š

1. å®‰è£…Immerï¼š`npm install use-immer`
2. å¯¼å…¥ï¼š`import { useImmer } from 'use-immer'`
3. å°†`useState`æ›¿æ¢ä¸º`useImmer`

```jsx
import { useImmer } from 'use-immer';

function Form() {
  const [person, updatePerson] = useImmer({
    name: 'Niki',
    artwork: {
      title: 'Blue Nana',
      city: 'Hamburg'
    }
  });

  function handleCityChange(e) {
    updatePerson(draft => {
      // å¯ä»¥ç›´æ¥"ä¿®æ”¹" draftå¯¹è±¡
      draft.artwork.city = e.target.value;
    });
  }
  
  // ...
}
```

Immerçš„ä¼˜åŠ¿ï¼š
- ğŸ“ ä»£ç æ›´ç®€æ´ï¼Œå°¤å…¶å¯¹åµŒå¥—å¯¹è±¡
- ğŸ›¡ï¸ å†…éƒ¨ä¼šç¡®ä¿æ­£ç¡®åˆ›å»ºæ–°å¯¹è±¡ï¼Œè€Œéä¿®æ”¹ç°æœ‰å¯¹è±¡
- ğŸ¯ å…è®¸ä½¿ç”¨ç†Ÿæ‚‰çš„å¯å˜æ“ä½œè¯­æ³•ï¼Œä½†å®é™…æ˜¯ä¸å¯å˜æ›´æ–°

## ğŸ¤” ä¸ºä½•ä¸æ¨èç›´æ¥ä¿®æ”¹stateå¯¹è±¡ï¼Ÿ

ä¸ç›´æ¥ä¿®æ”¹stateå¯¹è±¡çš„ç†ç”±ï¼š
- ğŸ **è°ƒè¯•æ›´å®¹æ˜“**ï¼šå†å²çŠ¶æ€ä¿æŒä¸å˜ï¼Œä¸ä¼šè¢«æ–°çŠ¶æ€è¦†ç›–
- ğŸš€ **æ€§èƒ½ä¼˜åŒ–**ï¼šä¾èµ–å¼•ç”¨ç›¸ç­‰æ£€æŸ¥çš„ä¼˜åŒ–ç­–ç•¥å¯ä»¥æ­£å¸¸å·¥ä½œ
- ğŸ”„ **æ–°åŠŸèƒ½å…¼å®¹**ï¼šæœªæ¥Reactç‰¹æ€§ä¾èµ–äºçŠ¶æ€ä¸å¯å˜æ€§
- â†©ï¸ **æ’¤é”€/é‡åš**ï¼šä¿ç•™å†å²çŠ¶æ€å‰¯æœ¬ä½¿å®ç°è¿™ç±»åŠŸèƒ½æ›´ç®€å•
- ğŸ§© **å®ç°æ›´ç®€å•**ï¼šä¸éœ€è¦å¯¹è±¡ä»£ç†æˆ–å…¶ä»–å¤æ‚æœºåˆ¶

## ğŸ“ æ€»ç»“

- ğŸ§Š å°†Reactä¸­çš„æ‰€æœ‰stateè§†ä¸ºä¸å¯ä¿®æ”¹çš„
- ğŸ”„ åœ¨stateä¸­å­˜å‚¨å¯¹è±¡æ—¶ï¼Œä¿®æ”¹å®ƒä»¬ä¸ä¼šè§¦å‘é‡æ–°æ¸²æŸ“ä¸”ä¼šæ”¹å˜"å¿«ç…§"
- ğŸ†• åˆ›å»ºæ–°å¯¹è±¡æ›¿ä»£ä¿®æ”¹ï¼Œé€šè¿‡setStateè§¦å‘æ¸²æŸ“
- ğŸ“‹ ä½¿ç”¨`{...obj, prop: newValue}`å±•å¼€è¯­æ³•åˆ›å»ºå¯¹è±¡å‰¯æœ¬
- âš ï¸ å±•å¼€è¯­æ³•æ˜¯æµ…æ‹·è´ï¼Œåªå¤åˆ¶ä¸€å±‚
- ğŸŒ² æ›´æ–°åµŒå¥—å¯¹è±¡éœ€è¦æ²¿è·¯å¾„åˆ›å»ºæ¯ä¸€å±‚çš„å‰¯æœ¬
- ğŸ§° ä½¿ç”¨Immeråº“å¯ä»¥å¤§å¹…ç®€åŒ–å¤æ‚çš„ä¸å¯å˜æ›´æ–°

> å‚è€ƒï¼š[Reactå®˜æ–¹æ–‡æ¡£-æ›´æ–°stateä¸­çš„å¯¹è±¡](https://zh-hans.react.dev/learn/updating-objects-in-state) 