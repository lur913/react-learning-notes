# ğŸ”„ React Stateæ›´æ–°é˜Ÿåˆ—

## ğŸ“‹ æ‰¹å¤„ç†æœºåˆ¶

Reacté€šè¿‡**æ‰¹å¤„ç†**ï¼ˆbatchingï¼‰æœºåˆ¶æ¥å¤„ç†å¤šä¸ªçŠ¶æ€æ›´æ–°ï¼Œæé«˜åº”ç”¨æ€§èƒ½ï¼š

- ğŸ“¦ æ‰¹å¤„ç†ï¼šReactä¼šç­‰åˆ°**äº‹ä»¶å¤„ç†å‡½æ•°ä¸­çš„æ‰€æœ‰ä»£ç æ‰§è¡Œå®Œæ¯•**åï¼Œæ‰ä¸€æ¬¡æ€§å¤„ç†æ‰€æœ‰çŠ¶æ€æ›´æ–°
- ğŸš€ è¿™ç§æœºåˆ¶ä½¿åº”ç”¨è¿è¡Œæ›´å¿«ï¼Œé¿å…ä¸å¿…è¦çš„é‡æ–°æ¸²æŸ“
- ğŸ›¡ï¸ é˜²æ­¢å‡ºç°"åŠæˆå“"æ¸²æŸ“ï¼Œé¿å…ç”¨æˆ·çœ‹åˆ°ä¸å®Œæ•´çš„UIçŠ¶æ€

```jsx
function handleClick() {
  // Reactä¼šç­‰è¿™äº›ä»£ç å…¨éƒ¨æ‰§è¡Œå®Œåï¼Œæ‰è¿›è¡Œä¸€æ¬¡æ¸²æŸ“
  setCount(count + 1);
  setFlag(true);
  setName('Alex');
}
```

## ğŸ” åŒä¸€äº‹ä»¶ä¸­å¤šæ¬¡æ›´æ–°ç›¸åŒçŠ¶æ€

### âš ï¸ å¸¸è§„æ›´æ–°çš„å±€é™æ€§

å½“ä½ åœ¨ä¸€ä¸ªäº‹ä»¶å¤„ç†å‡½æ•°ä¸­å¤šæ¬¡æ›´æ–°åŒä¸€ä¸ªçŠ¶æ€å˜é‡æ—¶ï¼Œåªæœ‰æœ€åä¸€æ¬¡æ›´æ–°ä¼šç”Ÿæ•ˆï¼š

```jsx
function handleClick() {
  setNumber(number + 1); // numberæ˜¯0
  setNumber(number + 1); // numberè¿˜æ˜¯0
  setNumber(number + 1); // numberè¿˜æ˜¯0
}
// ç»“æœï¼šnumberåªå¢åŠ åˆ°1ï¼Œè€Œä¸æ˜¯3
```

è¿™æ˜¯å› ä¸ºåœ¨åŒä¸€ä¸ªæ¸²æŸ“å‘¨æœŸä¸­ï¼Œ`number`çš„å€¼ä¿æŒä¸å˜ã€‚

### ğŸ”¢ æ›´æ–°å‡½æ•°è§£å†³æ–¹æ¡ˆ

ä¸ºäº†åœ¨å•ä¸ªäº‹ä»¶ä¸­å¤šæ¬¡æ›´æ–°åŒä¸€ä¸ªçŠ¶æ€ï¼Œå¯ä»¥**ä¼ å…¥æ›´æ–°å‡½æ•°**ï¼š

```jsx
function handleClick() {
  setNumber(n => n + 1); // æ¥æ”¶å…ˆå‰çš„çŠ¶æ€ä½œä¸ºå‚æ•°
  setNumber(n => n + 1); // åœ¨ä¸Šä¸€æ¬¡æ›´æ–°çš„åŸºç¡€ä¸Šç»§ç»­æ›´æ–°
  setNumber(n => n + 1); // å†æ¬¡æ›´æ–°
}
// ç»“æœï¼šnumberå¢åŠ åˆ°3
```

### ğŸ§® æ›´æ–°å‡½æ•°çš„å·¥ä½œåŸç†

å½“ä½ ä½¿ç”¨`setNumber(n => n + 1)`è¿™æ ·çš„æ›´æ–°å‡½æ•°æ—¶ï¼š

1. âœ‰ï¸ Reactå°†è¿™ä¸ªæ›´æ–°å‡½æ•°åŠ å…¥åˆ°é˜Ÿåˆ—ä¸­
2. ğŸ”„ åœ¨ä¸‹ä¸€æ¬¡æ¸²æŸ“æ—¶ï¼ŒReactæŒ‰é¡ºåºæ‰§è¡Œé˜Ÿåˆ—ä¸­çš„æ‰€æœ‰æ›´æ–°
3. ğŸ“Š æ¯ä¸ªæ›´æ–°å‡½æ•°çš„å‚æ•°æ˜¯å‰ä¸€ä¸ªå‡½æ•°è¿”å›çš„ç»“æœ

#### æ›´æ–°é˜Ÿåˆ—å¤„ç†ç¤ºä¾‹ï¼š

| æ›´æ–°é˜Ÿåˆ— | å½“å‰å€¼ n | è¿”å›å€¼ |
|---------|---------|--------|
| n => n + 1 | 0 | 1 |
| n => n + 1 | 1 | 2 |
| n => n + 1 | 2 | 3 |

## ğŸ”€ æ··åˆæ›´æ–°æ–¹å¼çš„æ•ˆæœ

Reactå¤„ç†æ›´æ–°é˜Ÿåˆ—çš„è§„åˆ™ï¼š
- ğŸ’¼ **æ›¿æ¢æ›´æ–°**ï¼š`setState(x)` ä¼šå°†"æ›¿æ¢ä¸ºx"åŠ å…¥é˜Ÿåˆ—ï¼Œä¸¢å¼ƒä¹‹å‰æ’é˜Ÿçš„æ›´æ–°
- ğŸ§© **å‡½æ•°æ›´æ–°**ï¼š`setState(n => ...)` ä¼šå°†æ›´æ–°å‡½æ•°åŠ å…¥é˜Ÿåˆ—ï¼Œåœ¨æ¸²æŸ“æ—¶æŒ‰é¡ºåºæ‰§è¡Œ

### ğŸ“ æ··åˆæ›´æ–°ç¤ºä¾‹

```jsx
function handleClick() {
  setNumber(number + 5); // "æ›¿æ¢ä¸º5"åŠ å…¥é˜Ÿåˆ—
  setNumber(n => n + 1); // å‡½æ•°æ›´æ–°åŠ å…¥é˜Ÿåˆ—
  setNumber(42);         // "æ›¿æ¢ä¸º42"åŠ å…¥é˜Ÿåˆ—
}
```

å¤„ç†è¿‡ç¨‹ï¼š
1. "æ›¿æ¢ä¸º5"ï¼šç»“æœä¸º5
2. n => n + 1ï¼šç»“æœä¸º6
3. "æ›¿æ¢ä¸º42"ï¼šç»“æœä¸º42

æœ€ç»ˆï¼Œstateæ›´æ–°ä¸º42ã€‚

## ğŸ’¡ å‘½åçº¦å®š

é€šå¸¸ï¼Œæ›´æ–°å‡½æ•°çš„å‚æ•°å¯ä»¥ç”¨çŠ¶æ€å˜é‡åçš„é¦–å­—æ¯å‘½åï¼š

```jsx
setEnabled(e => !e);
setLastName(ln => ln.reverse());
setCount(c => c + 1);
```

æ›´è¯¦ç»†çš„é£æ ¼å¯ä»¥ä½¿ç”¨å®Œæ•´çŠ¶æ€åæˆ–å¸¦å‰ç¼€çš„åç§°ï¼š
```jsx
setEnabled(enabled => !enabled);
setEnabled(prevEnabled => !prevEnabled);
```

## âš ï¸ æ³¨æ„äº‹é¡¹

- ğŸ§ª æ›´æ–°å‡½æ•°å¿…é¡»æ˜¯**çº¯å‡½æ•°**ï¼šåªè®¡ç®—å¹¶è¿”å›ç»“æœï¼Œä¸åº”æœ‰å‰¯ä½œç”¨
- ğŸ”„ åœ¨ä¸¥æ ¼æ¨¡å¼ä¸‹ï¼ŒReactä¼šæ‰§è¡Œæ¯ä¸ªæ›´æ–°å‡½æ•°ä¸¤æ¬¡ï¼ˆä½†ä¸¢å¼ƒç¬¬äºŒæ¬¡ç»“æœï¼‰ä»¥å¸®åŠ©å‘ç°é”™è¯¯
- ğŸŒ Reactåªå¯¹åŒä¸€äº‹ä»¶å†…çš„æ›´æ–°è¿›è¡Œæ‰¹å¤„ç†ï¼Œä¸ä¼šè·¨å¤šä¸ªäº‹ä»¶ï¼ˆå¦‚å¤šæ¬¡ç‚¹å‡»ï¼‰è¿›è¡Œæ‰¹å¤„ç†

## ğŸš€ å®ç”¨æŠ€å·§

- å½“éœ€è¦æ ¹æ®çŠ¶æ€çš„å…ˆå‰å€¼è¿›è¡Œæ›´æ–°æ—¶ï¼Œæ€»æ˜¯ä½¿ç”¨æ›´æ–°å‡½æ•°ï¼š`setState(prev => /* åŸºäºprevè®¡ç®— */)`
- å½“çŠ¶æ€æ›´æ–°ä¾èµ–äºå¦ä¸€ä¸ªçŠ¶æ€çš„å€¼æ—¶ï¼Œè€ƒè™‘åˆå¹¶ç›¸å…³çŠ¶æ€æˆ–ä½¿ç”¨reducer
- å¯¹äºéœ€è¦åˆå¹¶çš„å¤šä¸ªå¼‚æ­¥æ›´æ–°ï¼Œå¿…é¡»ä½¿ç”¨æ›´æ–°å‡½æ•°ä»¥é¿å…ç«æ€æ¡ä»¶

## ğŸ“ æ€»ç»“

- ğŸ”„ è®¾ç½®çŠ¶æ€ä¸ä¼šæ”¹å˜ç°æœ‰å˜é‡ï¼Œè€Œæ˜¯è¯·æ±‚æ–°çš„æ¸²æŸ“
- ğŸ“¦ Reactåœ¨äº‹ä»¶å¤„ç†å‡½æ•°æ‰§è¡Œå®Œæˆåæ‰¹å¤„ç†çŠ¶æ€æ›´æ–°ï¼ˆæ‰¹å¤„ç†ï¼‰
- ğŸ”¢ è¦åœ¨å•ä¸ªäº‹ä»¶ä¸­å¤šæ¬¡æ›´æ–°åŒä¸€çŠ¶æ€ï¼Œä½¿ç”¨`setState(n => n + 1)`å½¢å¼çš„æ›´æ–°å‡½æ•°
- ğŸ§® æ›¿æ¢æ›´æ–°ä¼šè¦†ç›–é˜Ÿåˆ—ä¸­ä¹‹å‰çš„æ›´æ–°ï¼Œè€Œå‡½æ•°æ›´æ–°ä¼šå§‹ç»ˆè¢«æ·»åŠ åˆ°é˜Ÿåˆ—ä¸­
- ğŸ§ª æ›´æ–°å‡½æ•°åº”è¯¥æ˜¯çº¯å‡½æ•°ï¼Œä¸”åªè¿”å›è®¡ç®—ç»“æœï¼Œä¸æ‰§è¡Œå‰¯ä½œç”¨

> å‚è€ƒï¼š[Reactå®˜æ–¹æ–‡æ¡£-æŠŠä¸€ç³»åˆ—stateæ›´æ–°åŠ å…¥é˜Ÿåˆ—](https://zh-hans.react.dev/learn/queueing-a-series-of-state-updates) 